#!~/miniconda2/envs/py3/bin/python
import os
import pandas as pd
import argparse

parser = argparse.ArgumentParser(description="purpose:handle the cov.gz result file generated by bismark")
parser.add_argument('-indir',"--indirectory", required = True,
                    help="The path of the cov.gz file")
args = parser.parse_args()

# get all the files read to merge
def file_name(file_dir):
    L=[]
    S=[]
    for root, dirs,files in os.walk(file_dir):
        for file in files:
            if file.find('.gz') != -1:
                L.append(file.split('.')[0])
                S.append(os.path.join(root, file))
    return(L,S)
sample,files = file_name(args.indirectory)

# handle all the samples,add title to these files
for i in range(0,len(sample)):
    col_name = ['Chr','Start','End',sample[i]+'_met%',sample[i]+'_Met',sample[i]+'_Unmet']
    df = pd.read_csv(files[i],
                      sep='\t',
                      header=None,
                      compression='gzip',
                      names=col_name).round({sample[i]+'_met%':2})
    df[sample[i]+'_Depth'] = df[sample[i]+'_Met'] + df[sample[i]+'_Unmet']
    df1=df[ ~ df['Chr'].str.contains('_')]
    prefix = sample[i] + '.met.txt'
    df1.to_csv(prefix,index = None)






